<!DOCTYPE html>
<html lang="en" ng-app="ConnectAnything">
<head>
    <title>CAT</title>
    <link rel="shortcut icon" href="favicon.ico"/>
    <script src="static/js/jquery.min.js"></script>
    <script src="static/js/jquery-ui.min.js"></script>
    <script src="static/js/angular.min.js"></script>
    <script src="static/js/jquery.jsPlumb-1.4.1-all.js"></script>
    <script src="static/js/underscore-min.js"></script>
    <script src="static/js/app.js"></script>

    <link rel="stylesheet" href="static/fnt/glyphicons-halflings-regular.ttf">

    <link rel="stylesheet" href="static/css/bootstrap.min.css">
    <link rel="stylesheet" href="static/css/app.css">
</head>
<body ng-controller="PinsCtrl">

<div id="hide-this-stuff-when-settings-are-shown"
  ng-class="{'hide': settings_pin !== null}">

    <div id="settings-button" class="black">
        <span class="glyphicon glyphicon-cog"></span>
    </div>

    <div id="column-divider" class="gray-border"></div>

    <div id="pins-container" class="container-fluid">
        <div class="row">
            <!-- TODO make sensors and actuators share a single 'template' -->
            <div id="sensors" class="col-xs-6">

                <div
                  ng-class="{
                      'empty-column-label': true,
                      'hide': (pins | sensors).length > 0}">
                    sensors
                </div>

                <div id="{{pin.id}}"
                  ng-repeat="pin in pins | sensors"
                  ng-class="{
                      'sensor':true,
                      'pin':true,
                      'yellow-border': true,
                      'connected':pin.is_connected,
                      'analog': pin.is_analog,
                      'digital': !pin.is_analog,
                      'activated': activated_sensor === pin.id}"
                  data-name="{{pin.name}}"
                  sensor>
                    <div class="pin-box" ng-click="show_settings_for(pin.id)">
                        <div class="pin-label">
                            {{pin.label}}
                        </div>
                        <div class="pin-name">
                            {{pin.name}}
                        </div>
                        <div class="pin-value-container">
                            <div class="pin-value" style="height:{{pin.value}}%;"></div>
                        </div>
                        <div class="endpoint-container"
                          ng-click="toggle_activated($event, pin.id)">
                            <div id="{{pin.id}}-endpoint"
                              class="endpoint yellow-bg">
                            </div>
                        </div>
                    </div>
                </div>
            </div> <!-- end sensors column -->

            <div id="actuators" class="col-xs-6">

                <div
                  ng-class="{
                      'empty-column-label': true,
                      'hide': (pins | actuators).length > 0}">
                    actuators
                </div>

                <div id="{{pin.id}}"
                  ng-repeat="pin in pins | actuators"
                  ng-class="{
                      'actuator':true,
                      'pin':true,
                      'green-border': true,
                      'connected':pin.is_connected,
                      'analog': pin.is_analog,
                      'digital': !pin.is_analog,
                      'activated': activated_sensor !== null,
                      'already-connected-to-activated-sensor': already_connected_to_activated_sensor()}"
                  data-name="{{pin.name}}"
                  actuator>
                    <div class="pin-box" ng-click="show_settings_for(pin.id)">
                        <div class="pin-label">
                            {{pin.label}}
                        </div>
                        <div class="pin-name">
                            {{pin.name}}
                        </div>
                        <div class="pin-value-container">
                            <div
                              ng-class="{
                                  'pin-value': true,
                                  'hide': pin.value < 0.5}"></div>
                        </div>
                        <div class="endpoint-container"
                          ng-click="connect_or_disconnect($event, pin.id)">
                            <div id="{{pin.id}}-endpoint"
                              class="endpoint green-bg">
                                <div class="endpoint-inner"></div>
                                <div class="slash"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div> <!-- end actuators column -->
        </div>
    </div> <!-- end pins-container -->

    <div id="connections-container">
        <div id="connect-{{c.source}}-{{c.target}}"
          ng-repeat="c in connections"
          class="connection"
          data-sensor_id="{{c.source}}"
          data-actuator_id="{{c.target}}"
          connection>
        </div>
    </div>

    <div id="footer" class="container-fluid">
        <div class="row">
            <div class="col-xs-2">
                <div id="add-sensors-button" class="button square yellow-bg">+</div>
            </div>
            <div class="col-xs-8">
                <div id="play-button" class="button wide black-bg">
                    <span class="glyphicon glyphicon-play"></span>
                    Play
                </div>
            </div>
            <div class="col-xs-2">
                <div id="add-actuators-button" class="button square green-bg">+</div>
            </div>
        </div>
    </div>
</div>

<div id="settings-container">

    <div ng-repeat="pin in pins | sensors"
      ng-class="{
          'settings': true,
          'hide': settings_pin !== pin.id,
          'analog': pin.is_analog,
          'sensor': pin.is_input}"
      sensor-settings>
        <div class="settings-inner">
            <div class="container-fluid">

                <div class="row">
                    <div class="col-xs-12 pin-name">
                        {{pin.name}}
                    </div>
                </div>

                <div class="row padded">
                    <div class="col-xs-2">
                        Name
                    </div>
                    <div class="col-xs-8">
                        <input type="text"
                          placeholder="Pin Label"
                          class="pin-label"
                          value="{{pin.label}}"
                          ng-blur="update_pin_label()">
                    </div>
                    <!-- TODO cap the label to 20 chars -->
                    <div class="col-xs-2">
                        <span class="extra-small">(20 char max)</span>
                    </div>
                </div>

                <div class="row padded">
                    <div class="col-xs-2">
                        Type
                    </div>
                    <div class="col-xs-10">
                        {{pin.type}}
                    </div>
                </div>

                <div class="row padded">
                    <div class="col-xs-6 text-center">
                        Calibrate
                    </div>
                    <div class="col-xs-6">
                        Damping
                    </div>
                </div>

                <div class="row padded">
                    <div class="col-xs-6">
                        <div class="sensor-value-settings">
                            <div class="vertical-slider-container triangle-point-right">
                                <input type="range"
                                  class="vertical-slider min"
                                  min="0"
                                  max="1"
                                  step="0.01"
                                  ng-model="pin.window_min"
                                  value="{{pin.window_min}}"
                                  ng-change="sync_min_max()">
                            </div>
                            <div class="pin-value-container">
                                <div class="threshold"
                                  style="bottom: {{100*average_min_max()}}%;"></div>
                                <div class="pin-value"
                                  style="height:{{pin.value}}%;"></div>
                            </div>
                            <div class="vertical-slider-container triangle-point-left">
                                <input type="range"
                                  class="vertical-slider max"
                                  min="0"
                                  max="1"
                                  step="0.01"
                                  ng-model="pin.window_max"
                                  value="{{pin.window_max}}"
                                  ng-change="sync_min_max()">
                            </div>
                        </div>
                    </div>
                    <div class="col-xs-6">
                        <!-- TODO template for this would be nice, will ng-change still work? -->
                        <div class="vertical-slider-container damping">
                            <input type="range"
                              class="vertical-slider"
                              ng-model="pin.damping"
                              min="0"
                              max="1"
                              step="0.01"
                              value="{{pin.damping}}"
                              ng-change="send_pin_update([pin.id])">
                        </div>
                    </div>
                </div>

                <div class="row padded">
                    <div class="col-xs-12">
                        <input type="checkbox"
                          ng-model="pin.is_inverted"
                          ng-change="send_pin_update([pin.id])">
                        <label for="checkbox">Invert</label>
                    </div>
                </div>

                <!-- TODO start using bootstrap buttons -->
                <div class="row padded">
                    <div class="col-xs-6">
                        <div class="button black-bg">
                            Remove
                        </div>
                    </div>
                    <div class="col-xs-6">
                        <div class="button black-bg" ng-click="close_settings()">
                            OK
                        </div>
                    </div>
                </div>

            </div> <!-- end container-fluid -->
        </div> <!-- end settings-inner -->
    </div> <!-- end settings for sensors -->

    <div ng-repeat="pin in pins | actuators"
      ng-class="{
          'settings': true,
          'hide': settings_pin !== pin.id,
          'digital': !pin.is_analog,
          'actuator': !pin.is_input}"
      actuator-settings>
        <div class="settings-inner">
            <div class="container-fluid">

                <div class="row">
                    <div class="col-xs-12 pin-name">
                        {{pin.name}}
                    </div>
                </div>

                <div class="row padded">
                    <div class="col-xs-2">
                        Name
                    </div>
                    <div class="col-xs-8">
                        <input type="text"
                          placeholder="Pin Label"
                          class="pin-label"
                          value="{{pin.label}}"
                          ng-blur="update_pin_label()">
                    </div>
                    <!-- TODO cap the label to 20 chars -->
                    <div class="col-xs-2">
                        <span class="extra-small">(20 char max)</span>
                    </div>
                </div>

                <div class="row padded">
                    <div class="col-xs-2">
                        Type
                    </div>
                    <div class="col-xs-10">
                        {{pin.type}}
                    </div>
                </div>

                <div class="row padded">
                    <div class="col-xs-6 text-center">
                        Value
                    </div>
                    <div class="col-xs-6">
                        Limit/Hold
                    </div>
                </div>

                <div class="row padded">
                    <div class="col-xs-6">
                        <div class="actuator-value-display">
                            <div class="pin-value-container">
                                <div ng-class="{
                                    'pin-value': true,
                                    'hide': pin.value < 0.5}">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xs-6">
                        <input type="checkbox"
                          ng-model="pin.is_limited"
                          ng-change="send_pin_update([pin.id])">
                        <label for="checkbox">Stay on for</label>
                        <input type="number"
                          ng-model="pin.limited_to"
                          ng-change="send_pin_update([pin.id])">
                        <label for="number">seconds</label>
                    </div>
                </div>

                <!-- TODO start using bootstrap buttons -->
                <div class="row padded">
                    <div class="col-xs-6">
                        <div class="button black-bg">
                            Remove
                        </div>
                    </div>
                    <div class="col-xs-6">
                        <div class="button black-bg" ng-click="close_settings()">
                            OK
                        </div>
                    </div>
                </div>

            </div> <!-- end container-fluid -->
        </div> <!-- end settings-inner -->
    </div> <!-- end settings for sensors -->
    <!-- TODO settings for actuators -->
    <div ng-repeat="pin in pins | actuators"></div>
</div>

<div id="loading" ng-class="{'hide': got_data}">
    <div id="loading-msg">
        waiting for server
    </div>
</div>

</body>
</html>
